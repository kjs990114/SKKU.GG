<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/ranking.css">
    <title>Ranking</title>
</head>
<body>
    <h1>Ranking</h1>
    <table >
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>NickName</th>
                <th>Tier</th>
                <th>Rank</th>
                <th>Point</th>
                <th>Department</th>
            </tr>
        </thead>
        <tbody id="result">

        </tbody>
        
    </table>
</body>
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script>    
    let infoList=[];
    window.onload = function(){
        fetch("/info",{method:"GET"})
        .then((res)=>res.json())
        .then((user)=>{
            for(let i=0;i<user.length;i++){
                ranking(user[i].name,user[i].nickname,user[i].tier,user[i].rank,user[i].point,user[i].depart);
            };
            infoList.sort(sortVal);
            for(let i =0;i<infoList.length;i++){
                $("#result").append("<tr>" + "<td>" +(i+1)+ "</td>" + "<td>" + infoList[i].name + "</td>" + "<td>"+infoList[i].userId + "</td>" + "<td>" + infoList[i].tier + "</td>" + "<td>" + infoList[i].rank + "</td>" + "<td>" +infoList[i].point+ "</td>" + "<td>"+infoList[i].department+"</td>"+"</tr>");
        }
        })
    }

    


    function ranking(name,nickname, tier, rank, point, department){
        let userInfo = {
            name: name,
        userId : nickname,
        tier: tier,
        rank: rank,
        point:  point,
        rankingVal: calcVal(rank, tier, point),
        department: department
        };
        infoList.push(userInfo);
    }



    function calcVal(rank, tier, point){
        let value = 0;
        switch(tier){
            case "IRON":
                value += 0;
                break;
            case "BRONZE":
                value += 10000;
                break;
            case "SILVER":
                value += 20000;
                break;
            case "GOLD":
                value += 30000;
                break;
            case "PLATINUM":
                value += 40000;
                break;
            case "DIAMOND":
                value += 50000;
                break;
            case "MASTER":
                value += 60000;
                break;
            case "UNRANK":
                value = 0;
                break;
            default:
                value += 70000;
                break;
        }
        switch(rank){
            case "I":
                value += 4000;
                break;
            case "II":
                value+=3000;
                break;
            case "III":
                value+=2000;
                break;
            case "IV":
                value+=1000;
                break;
            default:
                value+=0;
                break;
        }
        if(point === "UNRANK") value = 0;
        else{
            value += point;
        }
        

        return value;
    }
    function sortVal(a, b){
        return b.rankingVal - a.rankingVal;
    }


</script>
</html>