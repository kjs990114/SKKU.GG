<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p id="user-name"></p>
    <p id="user-level"></p>
    <div id=user-icon></div>

    <p>티어 :
        <span id="user-tier"></span>
        <span id="user-rank"></span>
        <span id="user-point"></span>
    </p>

    <span id="user-win"></span>승 / <span id="user-loss"></span>패





    <script>
        const api = "RGAPI-2e1ce1cf-6ec5-41ae-956a-d38e84664106";

        window.addEventListener("load", () => {
            fetch("/search", { method: "GET" })
                .then((res) => res.json())
                .then((nickname) => {
                    const url = "https://kr.api.riotgames.com/lol/summoner/v4/summoners/by-name/" + nickname["nick"] + "?api_key=RGAPI-2e1ce1cf-6ec5-41ae-956a-d38e84664106";
                    const xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function () {
                        if (this.status == 200) {
                            result = this.responseText;
                            const user_info = JSON.parse(result);
                            const id = user_info["id"];
                            const nick = user_info["name"];
                            const icon = user_info["profileIconId"];
                            const level = user_info["summonerLevel"];
                            document.getElementById("user-name").innerHTML = nick;
                            document.getElementById("user-level").innerHTML = level;

                            const img_src = 'http://ddragon.leagueoflegends.com/cdn/12.21.1/img/profileicon/' + icon + '.png';
                            let img = document.createElement('img');
                            img.src = img_src;
                            img.width = 100;
                            if (document.getElementById('user-icon').childElementCount === 0) {
                                document.getElementById('user-icon').appendChild(img);
                            }
                            const url2 = "https://kr.api.riotgames.com/lol/league/v4/entries/by-summoner/" + id + "?api_key=RGAPI-2e1ce1cf-6ec5-41ae-956a-d38e84664106";
                            const xmlhttp2 = new XMLHttpRequest();
                            xmlhttp2.onreadystatechange = function () {
                                if (this.status == 200) {

                                    const user_info2 = JSON.parse(this.responseText);
                                    const tier = user_info2[0]["tier"];
                                    const rank = user_info2[0]["rank"];
                                    const point = user_info2[0]["leaguePoints"];
                                    const win = user_info2[0]["wins"];
                                    const lose = user_info2[0]["losses"];
                                    document.getElementById("user-tier").textContent = tier;
                                    document.getElementById("user-rank").textContent = rank;
                                    document.getElementById("user-point").innerHTML = point;
                                    document.getElementById("user-win").innerHTML = win;
                                    document.getElementById("user-loss").innerHTML = lose;
                                }
                            }
                            xmlhttp2.open("GET", url2, true);
                            xmlhttp2.send();



                        }
                        else {
                            console.log("소환사를 찾을 수 없습니다.");
                        }
                    };

                    xmlhttp.open("GET", url, true);
                    xmlhttp.send();



                })
        })

    </script>
</body>

</html>